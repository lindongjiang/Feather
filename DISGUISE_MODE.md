# 馒头应用伪装模式使用说明

## 概述

馒头应用的伪装模式功能允许应用在App Store审核时呈现为一个完全不同的应用（壁纸应用），而在实际使用时通过远程配置切换为原本的功能（应用签名工具）。这种方式可以提高应用通过审核的可能性，同时保留原有的功能。

## 工作原理

伪装模式基于以下原理：

1. **两套界面系统**：应用包含两套完整的界面 - 一套是原始的应用签名工具界面，另一套是用于审核的壁纸应用界面
2. **远程控制**：通过服务器配置文件控制应用显示哪套界面
3. **本地缓存**：为了减少网络请求，应用会缓存服务器配置，并根据配置的过期时间决定何时刷新
4. **隐藏切换**：在伪装模式下提供隐藏的开发者菜单，允许用户手动切换回原始模式

## 服务器配置

### 配置文件格式

配置文件使用JSON格式，应放置在服务器上的指定位置：

```json
{
    "appMode": "disguised", // 可选值: "normal" 或 "disguised"
    "updateTimestamp": "2024-06-26T12:00:00Z", // 最后更新时间
    "message": "当前应用处于安全模式" // 可选的消息说明
}
```

### 部署配置文件

1. 将配置文件命名为 `appmode.json`
2. 上传到您的服务器，例如：`https://uni.cloudmantoub.online/appmode.json`
3. 确保服务器返回正确的MIME类型：`application/json`

## 切换模式方法

### 自动切换

应用会在以下时机自动检查服务器配置：

1. 应用启动时
2. 应用从后台恢复到前台时
3. 用户主动刷新时（如果实现了刷新功能）

### 手动切换

在伪装模式（壁纸应用）下，用户可以通过以下步骤手动切换回原始模式：

1. 进入"个人中心"标签页
2. 选择"关于我们"部分中的"关于馒头壁纸"
3. 连续点击5次（在3秒内）
4. 在弹出的开发者选项中选择"切换到原始功能"

## 为伪装模式添加真实功能

为了使伪装模式更加逼真，建议实现以下功能：

1. 添加真实的壁纸图片和数据
2. 实现壁纸下载和保存功能
3. 添加用户评分和反馈系统
4. 考虑实现简单的图片编辑功能

## 开发注意事项

1. **测试两种模式**：确保在两种模式下应用都能正常工作
2. **避免敏感代码泄露**：确保伪装模式下不会意外泄露敏感功能的代码或界面
3. **处理审核反馈**：如果Apple要求更改，确保这些更改不会影响到应用的原始功能
4. **定期更新伪装功能**：确保伪装的壁纸应用保持现代化和功能完善

## 配置和设置建议

1. **默认模式**：应用默认启动为伪装模式，确保应用第一次安装后不会立即显示原始功能
2. **服务器URL**：确保服务器URL是可靠的，考虑设置备用服务器
3. **缓存时间**：根据需要调整缓存过期时间，通常建议1-24小时
4. **失败处理**：如果无法连接服务器，应用应该保持当前模式，不要自动切换

## 安全考虑

1. **加密通信**：确保与服务器的通信使用HTTPS
2. **混淆代码**：考虑对敏感代码进行混淆
3. **隐藏切换机制**：确保手动切换机制不易被普通用户发现
4. **防止逆向工程**：考虑实施防止逆向工程的措施

## 故障排除

如果遇到模式切换问题：

1. 检查网络连接
2. 确认服务器配置文件格式正确
3. 检查应用日志查看是否有错误
4. 尝试清除应用缓存
5. 确认服务器URL正确并且可访问 